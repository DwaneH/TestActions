
# Advanced Topics

Now that you’ve built and tested workflows, let’s briefly look at some more advanced features of GitHub Actions.  
These are powerful tools you can explore as your projects grow.

---

## Manual Runs

Every time you want to run your workflow you need to make a commit and a `push`?  
You can also set up workflows to run **manually** from the GitHub UI:

```yaml
on:
  workflow_dispatch:
```

- Adds a “Run workflow” button in the Actions tab.
- Useful for tasks like deployments or test running scripts on demand.
- Note that the workflow needs to exist on `main` for this to be available.

---

## Storing and Sharing Artifacts

Workflows can store build outputs, known as artifacts, such as binaries, logs, or test results.  

Example:

```yaml
- name: Upload build output
  uses: actions/upload-artifact@v4
  with:
    name: my-app
    path: dist/
```

Later, another job can download the artifact:

```yaml
- name: Download build output
  uses: actions/download-artifact@v4
  with:
    name: my-app
```

Artifacts uploaded are available for download in the workflow page.  
Great for sharing compiled binaries, Docker images, or test reports between jobs or team members.  

---

## Self-Hosted Runners

- Instead of using GitHub’s hosted VMs, you can run jobs on **your own machines**.
- Useful if you need special hardware, private networks, or long-running jobs.
- Example use cases:
  - Building iOS apps (requires macOS hardware).
  - Deploying to internal servers.

See [Adding self-hosted runners](https://docs.github.com/en/actions/how-tos/manage-runners/self-hosted-runners/add-runners)  
Additionally it is good to know the limits of free Github Actions: [GitHub Actions billing](https://docs.github.com/en/billing/concepts/product-billing/github-actions)

---

## Custom Actions

- You can create your own reusable tasks to automate pieces of workflows like building, testing, or deploying code.
- Useful for simplifying repetitive tasks that may be used in multiple places.
- You can even group multiple steps into a single action.

In our workflow:
```yaml
jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [18.x, 20.x, 22.x]
    steps:
      - uses: actions/checkout@v4
      - name: Node Stuff
        uses: ./.github/actions/node
        with:
          node-version: ${{ matrix.node-version }}
```
In the same repository at `.github/actions/node/` we make an `action.yml` file:
```yaml
inputs:
  node-version:
    description: 'Node version to use'
    required: true
    default: 22.x
runs:
  using: "composite"
  steps:
    - uses: actions/setup-node@v4
      with:
        node-version: ${{ inputs.node-version }}
        cache: 'npm'
    - run: npm ci
      shell: bash
    - run: npm run build --if-present
      shell: bash
```

- We can pass variables between these reusable, templated, custom actions.
- These can be in a separate repository where you store all your custom actions for reuse throughout all your GitHub projects!  

For more detail see: [Creating a composite action](https://docs.github.com/en/actions/tutorials/create-actions/create-a-composite-action)

### Reusable Workflows

- Like the custom actions above, you can define workflows once and **reuse them** in multiple repositories.
- Useful for shared standards like a company-wide CI pipeline.

Example:

```yaml
jobs:
  call-workflow-test:
    uses: <org/user>/<repo>/.github/workflows/tests.yml@main
  call-workflow-publish:
    uses: <org/user>/<repo>/.github/workflows/publish.yml@main
```

More information availble in: [Reuse workflows](https://docs.github.com/en/actions/how-tos/reuse-automations/reuse-workflows)

---

## Workflow Permissions

- GitHub Actions permissions define what a workflow or job can do with your repository, such as reading, writing, or accessing secrets.
- Useful for security by restricting access to sensitive resources like deployment tokens or repository contents by default.
- Permissions can be set at the workflow or job level to control the scope of actions.

```yaml
permissions:
  contents: read
  pull-requests: write
jobs:
  build:
```

- The `permissions:` key at the workflow level sets default access for all jobs.
- Job-level permissions override workflow-level permissions for specific jobs (e.g., deploy job needs contents: write for deployment).
- Common permissions include:
  -  `contents` - `read` permits an action to list the commits, and `write` allows the action to create a release. 
  -  `pull-requests` - `write` permits an action to add a label, a comment, and even make and approve a pull request.
  -  `packages` - `write` permits an action to upload and publish packages on GitHub Packages.
- Use minimal permissions to reduce security risks.

For more detail see all available permission scopes at [Workflow Syntax - Permissions](https://docs.github.com/en/actions/reference/workflows-and-actions/workflow-syntax#permissions)

---

## Building and Publishing Docker Images

Actions are often used to automate Docker workflows.  

```yaml
jobs:
  dockerize:
    needs: build
    runs-on: ubuntu-latest
    permissions:
      packages: write
    steps:
      - uses: actions/checkout@v4
      - uses: docker/login-action@v3.0.0
      - uses: docker/metadata-action@v5.0.0
      - uses: docker/build-push-action@v5.0.0
```

- Here a job with entirely actions will login, create metadata, build, and push a Docker image to your GitHub Container Registry.
  - All the configuration of the actions has been removed from the example, but there are several variables used.
- See we have included a `permissions:` configuration. This helps let GitHub give more rights to the job being run.
- Any registry can be provided with the correct login credentials, just change the variables and secrets for registry and logins.

See additional details in the GitHub tutorial for [Publishing Docker images](https://docs.github.com/en/actions/tutorials/publish-packages/publish-docker-images)

---
